# Description:
#   Showing of BUS time
#
# Dependencies:
#   None
#
# Configuration:
#
# Commands:
#   hubot bus me     - Show the nearest bus time

BusonJ = '{"6:44":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"6:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"7:35":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u725b\u4e45\u99c5"}],"7:9":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],
"7:25":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"7:17":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"7:37":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"7:52":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"8:47":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],"8:05":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"8:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"8:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"8:19":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"8:37":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"8:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"9:45":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"}],
"9:53":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"9:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"9:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"9:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"9:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"9:29":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"9:44":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"9:59":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"10:52":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],
"10:27":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],"10:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"10:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"10:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"10:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"10:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"10:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"11:50":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"}],
"11:8":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"11:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"11:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"11:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"11:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"11:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"11:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"12:36":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"12:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"12:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"12:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"12:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"12:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"12:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"13:14":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"},{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"13:35":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"},{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"13:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"13:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"13:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"13:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"14:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"14:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"14:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"14:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"14:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"14:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"15:15":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"},{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"15:30":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"15:22":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],
"15:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"15:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"15:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"15:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"15:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"16:27":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],"16:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"16:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"16:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"16:04":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"16:24":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"16:39":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"16:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"16:12":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"16:7":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"}],
"17:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"17:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"17:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"17:09":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"17:29":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"17:39":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"17:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"17:22":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"18:22":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u571f\u6d66\u99c5"}],"18:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"18:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"18:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"18:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"18:29":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"18:44":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"18:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"18:17":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"}],"19:0":[{"Stop":"\u5927\u5b66\u75c5\u9662","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"19:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"19:35":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"19:55":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"19:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"19:59":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"20:15":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"20:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"20:54":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],
"20:39":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"20:8":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3072\u305f\u3061\u91ce\u3046\u3057\u304f\u99c5"}],"20:12":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u8352\u5ddd\u6c96\u99c5\u897f\u53e3"}],
"21:14":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"21:44":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"21:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],
"22:24":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}],"22:34":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u571f\u6d66\u99c5\u897f\u53e3"}],"23:4":[{"Stop":"\u5927\u5b66\u75c5\u9662\u5165\u53e3","Dest":"\u3064\u304f\u3070\u30bb\u30f3\u30bf\u30fc"}]}'

Buson = JSON.parse(BusonJ)
#console.error(Buson)
module.exports = (robot) ->
  robot.respond /bus me/i, (msg) ->
    currTime = new Date()
    dTime = new Object()
    for time of Buson
      [hour,min] = time.split(":")
      bTime = new Date()
      bTime.setHours(hour)
      bTime.setMinutes(min)
      dif = bTime.getTime() - currTime.getTime()
      dTime["#{dif}"] = time
      ndt = new Array()
      for dt in Object.keys(dTime).sort((v1,v2) -> v1-v2)
        if dt > 1000*60*3
          ndt.push(dt)

    ndt = ndt.sort((v1,v2) -> v1-v2)
    for candidate in [0..2]
      bustime = dTime[ndt[candidate]]
      cand = candidate + 1
      for buses in Buson[bustime]
        msg.send "いまから#{cand}番目のバスは，#{buses.Stop}バス停を #{bustime} 発, #{buses.Dest}ゆき です"
